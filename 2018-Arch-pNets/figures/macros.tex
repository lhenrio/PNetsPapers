\usepackage{xifthen}

% Simon's macros for the BIPspec-ArchFailureTimerMax diagrams
\newcommand{\cstate}[1]{\ensuremath{s_{#1}}}
\newcommand{\tstate}[1]{\ensuremath{t_{#1}}}

\newcommand{\NameCtrl}{\ensuremath{\mathit{Ctrl}}}
\newcommand{\NameTimer}{\ensuremath{\mathit{Timer}}}
\newcommand{\NameOprnd}{\ensuremath{B}}

\newcommand{\figport}[2][]{%
  \setlength{\fboxsep}{1pt}%
  \setlength{\fboxrule}{0.5pt}%
  \fbox{%
    \ifthenelse{\equal{#1}{}}{#2}{\ensuremath{
      \begin{array}{@{}c@{}}
        #2\\\hline
        #1
      \end{array}%
    }}%
  }%
}
\newcommand{\PortFinish}{\ensuremath{\mathsf{finish}}}
\newcommand{\PortFail}{\ensuremath{\mathsf{fail}}}
\newcommand{\PortResume}{\ensuremath{\mathsf{resume}}}
\newcommand{\PortReset}{\ensuremath{\mathsf{reset}}}
\newcommand{\PortTO}{\ensuremath{\mathsf{timeout}}}
\newcommand{\PortStart}{\ensuremath{\mathsf{start}}}
\newcommand{\PortTick}{\ensuremath{\mathsf{tick}}}
\newcommand{\PortCancel}{\ensuremath{\mathsf{cancel}}}
\newcommand{\PortAsk}{\ensuremath{\mathsf{ask}}}

\newcommand{\topinterval}{\ensuremath{\top}}
\newcommand{\TimerInitCount}[1][]{\ensuremath{t {:=} 0}}
\newcommand{\TimerInitZone}[1][]{\ensuremath{z {:=} \topinterval}}
\newcommand{\TimerInit}[1][]{\TimerInitCount, \TimerInitZone}

\newcommand{\TimerUpd}[1][]{\ensuremath{t {:=} t {+} 1}}
\newcommand{\GuardTick}[1][]{\ensuremath{[t {<} z.u]}}
\newcommand{\GuardTO}[1][]{\ensuremath{[t \in \mathit{z}]}}

\newcommand{\InitTransfer}[1][]{\ensuremath{%
    \begin{aligned}
      &\NameTimer.\mathit{z} := \NameTimer.\mathit{z} \cap\\[-4pt]
      &\quad\Big(    
    \bigl(
    \NameCtrl.\PortFail\ ?\ \NameCtrl.\mathit{zone} : \topinterval
    \bigr)\\[-5pt]
    &\qquad + \NameTimer.\mathit{t}
    \Big)%
    \end{aligned}
}}
\newcommand{\IntervalInit}[1][]{\ensuremath{\mathit{zone} {:=} [\mathrm{Min}, \mathrm{Max}]}}
